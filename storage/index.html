<!DOCTYPE html>
<html lang="en">


<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="zend-authentication">  
    <link rel="shortcut icon" href="../img/favicon.ico">

    <title>Identity Persistence - zend-authentication</title>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="../css/styles-288837cc22.css">

    
</head>

<body>

    <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            

            <!-- Main title -->
            <span class="navbar-brand">
                <a class="logo-link" href="https://framework.zend.com/" data-toggle="tooltip" data-placement="bottom" title="Go to the ZF homepage"><img src="../img/zf-logo-mark.svg" height="28" alt="Zend Framework" /></a>
                <a href="..">zend-authentication</a>
            </span>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
            
                <!-- Main navigation -->
                <ul class="nav navbar-nav">
                
                
                
                    <li >
                        <a href="..">zend-authentication</a>
                    </li>
                
                
                
                
                
                    <li >
                        <a href="../intro/">Intro</a>
                    </li>
                
                
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Adapters <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            

<li >
    <a href="../adapter/intro/">Intro</a>
</li>


                        
                            

  <li class="dropdown-submenu">
    <a tabindex="-1" href="">DbTable</a>
    <ul class="dropdown-menu">
        
            

<li >
    <a href="../adapter/dbtable/intro/">Intro</a>
</li>


        
            

<li >
    <a href="../adapter/dbtable/credential-treatment/">CredentialTreatmentAdapter</a>
</li>


        
            

<li >
    <a href="../adapter/dbtable/callback-check/">CallbackCheck</a>
</li>


        
    </ul>
  </li>


                        
                            

<li >
    <a href="../adapter/digest/">Digest</a>
</li>


                        
                            

<li >
    <a href="../adapter/http/">HTTP</a>
</li>


                        
                            

<li >
    <a href="../adapter/ldap/">LDAP</a>
</li>


                        
                        </ul>
                    </li>
                
                
                
                
                
                    <li class="active">
                        <a href="./">Identity Persistence</a>
                    </li>
                
                
                
                
                
                    <li >
                        <a href="../validator/">Validation</a>
                    </li>
                
                
                
                </ul>
            

            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="#" class="component-toggle" data-toggle="tooltip" data-placement="bottom" title="Show component list">
                        <i class="fa fa-book"></i> Components
                    </a>
                </li>

                <li>
                    <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                        <i class="fa fa-search"></i> Search
                    </a>
                </li>
                
                    <li>
                        <a href="https://github.com/zendframework/zend-authentication/">
                            
                                <i class="fa fa-github"></i>
                            
                            GitHub
                        </a>
                    </li>
                
            </ul>
        </div>
    </div>
</div>

    <!-- content:begin -->
    <div id="page-top" class="container docs">
        
        <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
    
        <li class="main active"><a href="#identity-persistence">Identity Persistence</a></li>
        
            <li><a href="#default-persistence-in-the-php-session">Default Persistence in the PHP Session</a></li>
        
            <li><a href="#modifying-the-session-namespace">Modifying the Session Namespace</a></li>
        
            <li><a href="#chain-storage">Chain Storage</a></li>
        
            <li><a href="#implementing-custom-storage">Implementing Custom Storage</a></li>
        
    
    </ul>

    
    <ul class="pager hidden-print">
      <li class="previous">
        <a rel="prev" href="../adapter/ldap/"><i class="fa fa-arrow-left"></i> Previous</a>
      </li>
      <li class="next">
        <a rel="next" href="../validator/">Next <i class="fa fa-arrow-right"></i></a>
      </li>
    </ul>
    
</div></div>
        <div class="col-md-9" role="main">

<ol class="breadcrumb" role="navigation" aria-label="breadcrumbs navigation">
  <li><a href="..">zend-authentication</a></li>
  
    
  
  <li class="active">Identity Persistence</li>
</ol>

<h1 id="identity-persistence">Identity Persistence</h1>
<p>Authenticating a request that includes authentication credentials is useful, but
it is also often useful to persist the authenticated identity between requests, so
the user does not need to provide credentials with each request.</p>
<p>HTTP is a stateless protocol; however, techniques such as cookies and sessions
have been developed in order to facilitate maintaining state across multiple
requests in server-side web applications.</p>
<h2 id="default-persistence-in-the-php-session">Default Persistence in the PHP Session</h2>
<p>By default, zend-authentication provides persistent storage of the identity from a successful
authentication attempt using PHP session facilities. Upon a successful authentication attempt,
<code>Zend\Authentication\AuthenticationService::authenticate()</code> stores the identity from the
authentication result into persistent storage. Unless specified otherwise,
<code>Zend\Authentication\AuthenticationService</code> uses a storage class named
<code>Zend\Authentication\Storage\Session</code>, which depends on
<a href="https://github.com/zendframework/zend-session">zend-session</a>.</p>
<p>You may also implement <code>Zend\Authentication\Storage\StorageInterface</code>, and
provide your implementation to <code>Zend\Authentication\AuthenticationService::setStorage()</code>.</p>
<blockquote>
<h3 id="bypass-the-authenticationservice">Bypass the AuthenticationService</h3>
<p>If automatic persistent storage of the identity is not appropriate for your
use case, you can skip usage of <code>Zend\Authentication\AuthenticationService</code>
altogether, and instead use an adapter directly.</p>
</blockquote>
<h2 id="modifying-the-session-namespace">Modifying the Session Namespace</h2>
<p><code>Zend\Authentication\Storage\Session</code> uses the session namespace <code>Zend_Auth</code>.
This namespace may be overridden by passing a different value to the constructor
of <code>Zend\Authentication\Storage\Session</code>, and this value is internally passed
along to the constructor of <a href="https://github.com/zendframework/zend-session">Zend\Session\Container</a>.
This should occur before authentication is attempted, since
<code>Zend\Authentication\AuthenticationService::authenticate()</code> injects the
authenticated identity into the configured storage.</p>
<pre class="codehilite"><code class="language-php">use Zend\Authentication\AuthenticationService;
use Zend\Authentication\Storage\Session as SessionStorage;

$auth = new AuthenticationService();

// Use 'someNamespace' instead of 'Zend_Auth'
$auth-&gt;setStorage(new SessionStorage('someNamespace'));

// Set up the auth adapter, $authAdapter
$authAdapter = /* ... */;

// Authenticate, saving the result, and persisting the identity on success:
$result = $auth-&gt;authenticate($authAdapter);</code></pre>

<h2 id="chain-storage">Chain Storage</h2>
<p>A website might use multiple storage strategies for identity persistence; the
<code>Chain</code> Storage can be used to glue these together.</p>
<p>For example, the <code>Chain</code> can be configured to first use <code>Session</code> storage and
then use an <code>OAuth</code> storage adapter. One could configure this in the following
way:</p>
<pre class="codehilite"><code class="language-php">$storage = new Chain;
$storage-&gt;add(new Session);
$storage-&gt;add(new OAuth);   // Note: imaginary storage, not part of zend-authentication</code></pre>

<p>When the <code>Chain</code> Storage is used, its underlying storage adapters will be
consulted in the order in which they were added to the chain. Using our scenario
above, the <code>Session</code> storage adapter will be consulted first. When that happens:</p>
<ul>
<li>If the <code>Session</code> storage is non-empty, the <code>Chain</code> will use and return its
  contents.</li>
<li>If the <code>Session</code> storage is empty, the <code>Chain</code> will move on to the <code>OAuth</code>
  storage adapter.</li>
<li>If the <code>OAuth</code> storage is empty, the <code>Chain</code> will return an empty result.</li>
<li>If the <code>OAuth</code> storage is non-empty, the <code>Chain</code> will use and return its
  contents. However, it will <em>also</em> populate all storage adapters with higher
  priority with the contents; in our example, the <code>Session</code> storage will be
  populated, but if we'd added any adapters after the <code>OAuth</code> adapter, they
  would not.</li>
</ul>
<p>The priority of storage adapters in the Chain can be made explicit via the
<code>Chain::add</code> method, which accepts a second argument indicating the priority.
(Per standard priority queue usage, higher values have higher priority, and
lower or negative values have lower priority.)</p>
<pre class="codehilite"><code class="language-php">$chain-&gt;add(new A, 2);
$chain-&gt;add(new B, 10); // B will be used first</code></pre>

<h2 id="implementing-custom-storage">Implementing Custom Storage</h2>
<p>Sometimes developers may need to use a different identity storage mechanism than
that provided by <code>Zend\Authentication\Storage\Session</code>. To do so, implement
<code>Zend\Authentication\Storage\StorageInterface</code> and supply an instance of your
implementation to <code>Zend\Authentication\AuthenticationService::setStorage()</code>.</p>
<p>The following examples demonstrate the process.</p>
<p>First, implement <code>Zend\Authentication\Storage\StorageInterface</code>:</p>
<pre class="codehilite"><code class="language-php">&lt;?php
namespace My;

use Zend\Authentication\Storage\StorageInterface;

class Storage implements StorageInterface
{
    /**
     * Returns true if and only if storage is empty.
     *
     * @return boolean
     * @throws \Zend\Authentication\Exception\ExceptionInterface If it is
     *     impossible to determine whether storage is empty.
     */
    public function isEmpty()
    {
        /**
         * @todo implementation
         */
    }

    /**
     * Returns the contents of storage.
     *
     * Behavior is undefined when storage is empty.
     *
     * @return mixed
     * @throws \Zend\Authentication\Exception\ExceptionInterface If reading
     *     contents from storage is impossible
     */

    public function read()
    {
        /**
         * @todo implementation
         */
    }

    /**
     * Writes $contents to storage.
     *
     * @param  mixed $contents
     * @return void
     * @throws \Zend\Authentication\Exception\ExceptionInterface If writing
     *     $contents to storage is impossible
     */

    public function write($contents)
    {
        /**
         * @todo implementation
         */
    }

    /**
     * Clears contents from storage.
     *
     * @return void
     * @throws \Zend\Authentication\Exception\ExceptionInterface If clearing
     *     contents from storage is impossible.
     */

    public function clear()
    {
        /**
         * @todo implementation
         */
    }
}</code></pre>

<p>In order to use this custom storage class, <code>Zend\Authentication\AuthenticationService::setStorage()</code>
is invoked before an authentication query is attempted:</p>
<pre class="codehilite"><code class="language-php">use My\Storage;
use Zend\Authentication\AuthenticationService;

// Create the authentication service instance:
$auth = new AuthenticationService();

// Instruct the authentication service to use the custom storage class:
$auth-&gt;setStorage(new Storage());

// Create the authentication adapter:
$adapter = /* ... */;

// Authenticate, saving the result, and persisting the identity on success:
$result = $auth-&gt;authenticate($adapter);</code></pre>

<hr />


<nav>
  <ul class="pager hidden-print">
    <li class="previous">
      <a rel="prev" href="../adapter/ldap/"><i class="fa fa-arrow-left"></i> Previous</a>
    </li>
    <li class="next">
      <a rel="next" href="../validator/">Next <i class="fa fa-arrow-right"></i></a>
    </li>
  </ul>
</nav>
</div>
        
    </div>
    <!-- content:end -->

    <div id="footerwrap">
    <div class="container">
        <div class="row site-map">
            <div class="col-lg-3">
              <p>
                <strong>Zend Framework</strong><br />
                <a href="https://framework.zend.com/">framework.zend.com</a><br />
                <a href="https://docs.zendframework.com">docs.zendframework.com</a><br />
                <a href="https://packages.zendframework.com">packages.zendframework.com</a><br />
                <a href="https://apigility.org">apigility.org</a><br />
              </p>
            </div>
        </div>

        <div class="row">
            <div class="col-lg-12 centered">
                <a class="back-to-top" href="#page-top"><i class="fa fa-chevron-circle-up fa-4" aria-hidden="true"></i></a>
            </div>
        </div>

        <div class="spacing"></div>

        <div class="row">
            <div class="col-lg-8">
                <h4>Copyright</h4>
                <div class="hline-w"></div>

                <p>&copy; 2006-2017 by <a href="https://www.zend.com/">Zend</a>, a <a href="https://www.roguewave.com/">Rogue Wave Company</a>.</p>
            </div>

            <div class="col-lg-4">
                <h4>Contacts</h4>
                <div class="hline-w"></div>
                <p>
                    <a href="https://discourse.zendframework.com" class="btn-social btn-outline" alt="Forum" title="Forum"><i class="fa fa-comments"></i></a>
                    <a href="https://zendframework-slack.herokuapp.com" class="btn-social btn-outline" alt="Slack" title="Slack"><i class="fa fa-slack"></i></a>
                    <a href="https://github.com/zendframework" class="btn-social btn-outline" alt="Github" title="Github"><i class="fa fa-github"></i></a>
                    <a href="https://twitter.com/zfdevteam" class="btn-social btn-outline" alt="Twitter" title="Twitter"><i class="fa fa-twitter"></i></a>
                </p>
            </div>
        </div>
    </div>
</div>

    <script src="https://cdn.jsdelivr.net/npm/jquery@2.2.4/dist/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/js/bootstrap.min.js"></script>
    <script>var base_url = '..';</script>
    <script src="../js/scripts-0b6185f4a5.js"></script>
    <script data-main="../mkdocs/js/search.js" src="../mkdocs/js/require.js"></script>
        <script src="../search/require.js"></script>
        <script src="../search/search.js"></script>

    <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">
                        <span aria-hidden="true">&times;</span>
                        <span class="sr-only">Close</span>
                    </button>
                    <h4 class="modal-title" id="exampleModalLabel">Search</h4>
                </div>
                <div class="modal-body">
                    <p>
                        From here you can search these documents. Enter your search terms below.
                    </p>
                    <form role="form">
                        <div class="form-group">
                            <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query">
                        </div>
                    </form>
                    <div id="mkdocs-search-results"></div>
                </div>
                <div class="modal-footer">
                </div>
            </div>
        </div>
    </div>

    <div class="zf-components">
  <div class="zf-components-grid">
    <div class="zf-logo">
      <a href="https://framework.zend.com" data-toggle="tooltip" data-placement="bottom" title="Go to the ZF homepage"><img src="../img/zf-logo-mark.svg" alt="Zend Framework" width="250" /></a>
    </div>

    <div class="component-list"></div>

    <p class="zf-components-rollup"><a href="#">Hide list</a></p>
  </div>
</div>

</body>


</html>
